$schema: 'https://moonrepo.dev/schemas/tasks.json'

fileGroups:
  configs:
    - '.*.yml'
    - /moon.yml
  sourcess:
    - Gemfile
    - Gemfile.lock
    - Rakefile
    - 'lib/**/*'
    - 'spec/**/*'
    - 'sig/**/*'
    - '*.gemspec'

tasks:
  lock-platform:
    command: |
      bundle lock --add-platform arm64-darwin && \
      bundle lock --add-platform x86_64-linux
  config:
    command: "bundle config set path \"vendor/bundle\""
  install:
    command: "bundle install"
    deps:
      - config
  spec:
    command: "bundle exec rake spec"
    deps:
      - install
  lint:
    command: "bundle exec rake standard"
    deps:
      - install
  generate_sig:
    command: |
      git ls-files lib | \grep \.rb | xargs cat > sig/${MOON_PROJECT_ID}.rbs && \
      bundle exec sord --rbs sig/${MOON_PROJECT_ID}.rbs
    deps:
      - install
